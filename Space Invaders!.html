<html>

<canvas id = "gameCanvas" width = "800" height = "600"></canvas>

<script type = "text/javascript">
var canvas;
var canvasContext;
var fps = 30;
var currFrame = 0;
var frameShot = -1;
var player;
var playerImage = "player ship.png";
var playerStartX = 0;
var playerStartY = 0;
var playerWidth = 75;
var playerHeight = 100;
	
var bulletsOnScreen;
var bulletWidth = 5;
var bulletHeight = 20;
var enemy1;
var enemy1Frames;
var enemy1NumFrames = 2;
	
var barrier;
var barrierFrames;
var barrierNumFrames = 5;
class SpaceShip {
	constructor(left, top, width, height, picture) {
		this.tag = 'Enemy';
		this.left = left;
		this.top = top;
		this.width = width;
		this.height = height;
		this.currPic = picture;
		this.speedX = 0;
		this.speedY = 0;
		this.isShoot = false;
	}
	draw() {
		drawImage(this.left, this.top, this.width, this.height, this.currPic);
	}
	collisionDetect(obj) {
		return collisionRect(this, obj);
	}
}
class Bullet {
	constructor(left, top, width, height, color) {
		this.tag = 'Bullet';
		this.left = left;
		this.top = top;
		this.width = width;
		this.height = height;
		this.color = color;
		this.speedY = -15;
		this.speedX = 0;
		this.hit = false;
	}
	draw() {
		if(!this.hit) {
			colorRect(this.left, this.top, this.width, this.height, this.color);
		}
	}
	collisionDetect(obj) {
		return collisionRect(this, obj);
	}
}
class Enemy {
	constructor(left, top, width, height, pictures) {
		this.tag = 'Enemy';
		this.left = left;
		this.top = top;
		this.width = width;
		this.height = height;
		this.currPic = pictures[0];
		this.speedX = 1;
		this.speedY = 1;
	}
	draw() {
		drawImage(this.left, this.top, this.width, this.height, currPic);
	}
	collisionDetect(obj) {
		return collisionRect(this, obj);
	}
}
function init() {
	canvas = document.getElementById('gameCanvas');
	canvasContext = canvas.getContext('2d');
	enemy1Frames = new Array(0);
	barrierFrames = new Array(0);
	playerStartX = canvas.width / 2 - playerWidth / 2;
	playerStartY = canvas.height - playerHeight;
	player = new SpaceShip(playerStartX, playerStartY, playerWidth, playerHeight, playerImage);
	for(i = 0; i < enemy1NumFrames; i++){
		enemy1Frames.push("enemy 1 f" + (i + 1) + ".png");
	}
	for(i = 0; i < barrierNumFrames; i++) {
		barrierFrames.push("barrier f" + (i + 1) + ".png");
	}
	bulletsOnScreen = new Array(0); 
	setInterval(doFrame, 1000 / fps);
	canvas.addEventListener('mousemove', mouseMoveHandler);
	window.addEventListener('keydown', keyDownHandler, false);
	window.addEventListener('keyup', keyUpHandler, false);
}
	
function doFrame() {
	move();
	draw();
}
function draw() {
	currFrame++;
	if(currFrame > fps) {
		currFrame -= fps;	
	}
	for(i = 0; i < bulletsOnScreen.length; i++){
		bulletsOnScreen[i].left += bulletsOnScreen[i].speedX;
		bulletsOnScreen[i].top += bulletsOnScreen[i].speedY;
	}
	colorRect(0, 0, canvas.width, canvas.height, 'black');
	player.draw();
	if(player.isShoot) {
		if(frameShot == -1) {
			frameShot = currFrame;
			bulletsOnScreen.push(new Bullet(player.left + player.width / 2 - bulletWidth / 2, player.top, bulletWidth, bulletHeight, 'white'));
		} else if (((currFrame + fps) - frameShot) % (fps / 2) == 0) {
			bulletsOnScreen.push(new Bullet(player.left + player.width / 2 - bulletWidth / 2, player.top, bulletWidth, bulletHeight, 'white'));	
		}
	}
	//console.log(currFrame, frameShot);
	for(i = 0; i < bulletsOnScreen.length; i++){
		if(bulletsOnScreen[i].hit || bulletsOnScreen[i].top + bulletsOnScreen[i].height < 0) {
			bulletsOnScreen.splice(i, 1);
			i--;
		}
		else{
			bulletsOnScreen[i].draw();
		}
	}
}
function move() {
	
}
	
function keyDownHandler(e) {
	switch(e.keyCode) {
		case 32:
			player.isShoot = true;
			break;
	}
}
	
function keyUpHandler(e) {
	switch(e.keyCode) {
		case 32:
			player.isShoot = false;
			frameShot = -1;
			break;
	}
}
	
function mouseMoveHandler(e){
	var mousePos = calculateMousePos(e);
	if(mousePos.x - player.width / 2 <= 0){
		player.left = 0;
	} else if (mousePos.x + player.width / 2 >= canvas.width){
		player.left = canvas.width - player.width;
	} else {
		player.left = mousePos.x - player.width / 2;
	}
}
function calculateMousePos(e) {
	var rect = canvas.getBoundingClientRect();
	var root = document.documentElement;
	var mouseX = e.clientX - rect.left - root.scrollLeft;
	var mouseY = e.clientY - rect.top - root.scrollTop;
	return {
		x : mouseX,
		y : mouseY
	};
}
	
function collisionRect(rect1, rect2) {
	if (rect2.left + rect2.width / 2 >= rect1.left && rect2.left + rect2.width / 2 <= rect1.left + rect1.width) {
			if (rect2.top + rect2.height >= rect1.top) {
				if (rect2.top + rect2.height - rect2.speedY < rect1.top) {
					return 'top';
				}
			}
			if (rect2.top <= rect1.top + rect1.height) {
				if (rect2.top - rect2.speedY > rect1.top + rect1.height) {
					return 'bottom';
				}
			}
		}
		if (rect2.top + rect2.height / 2 >= rect1.top && rect2.top + rect2.height / 2 <= rect1.top + rect1.height) {
			if (rect2.left + rect2.width >= rect1.left) {
				if (rect2.left + rect2.width - rect2.speedX < rect1.left) {
					return 'left';
				}
			}
			if (rect2.top <= rect1.top + rect1.height) {
				if (rect2.left - rect2.speedX > rect1.left + rect1.width) {
					return 'right';
				}
			}
		}
		return 'none';
}
  
function colorRect(leftX, topY, width, height, drawColor) {
	canvasContext.fillStyle = drawColor;
	canvasContext.fillRect(leftX, topY, width, height);
}
	
function drawImage(left, top, width, height, image) {
	var drawing = new Image();
 	drawing.src = image;
	drawing.onload = function() {
		canvasContext.drawImage(drawing, left, top, width, height);
	};
}

window.onload = init;
</script>

</html>
